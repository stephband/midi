<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="author" content="" />
	<meta name="description" content="" />

	<title>MIDIRouter</title>

	<script>document.documentElement.className = 'js';</script>

	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />

	<link rel="icon" type="image/png" href="images/favicon.png" />
	<link rel="apple-touch-icon" href="/apple-touch-icon.png" />

	<!--link rel="stylesheet" href="/css/bolt.normalise.css" />
	<link rel="stylesheet" href="/css/bolt.typography.css" />
	<link rel="stylesheet" href="/css/bolt.typography.15_24.css" />
	<link rel="stylesheet" href="/css/bolt.forms.css" />
	<link rel="stylesheet" href="/css/bolt.classes.css" /-->

	<link rel="stylesheet" href="css/bolt.css" />
	<link rel="stylesheet" href="css/midi.css" />
	<link rel="stylesheet" href="css/midi-graph.css" />
</head>

<body>
	<h1>MIDI</h1>

	<ul class="link-index index">
		<li>repo: <a href="http://github.com/stephband/midi">github.com/sound-io/midi</a></li>
		<!--li>author: <a href="https://cruncher.ch/en/about-us/">stephband</a></li-->
	</ul>

	<canvas class="midi-graph block" id="midi-graph" width="960"></canvas>

	<p class="block">Plug in a MIDI instrument!<p>

	<p class="block">
		This example takes midi events from all inputs, filters them to
		<code>noteon</code>, <code>noteoff</code> and <code>pitch</code>
		normalises the messages (to Music JSON) and logs the results.
	</p>

	<!--script src="js/midi.js"></script-->
	<script src="modules/fn/js/fn.js"></script>
	<script src="modules/fn/js/stream.js"></script>
	<script src="modules/fn/js/dom.js"></script>
	<script src="js/midi.js"></script>
	<script src="js/midi-utils.js"></script>

	<script class="block">
//MIDI.on({ message: /^note|^pitch/ }, function(message, time) {
//    var event = MIDI.normalise(message, time);
//    console.log(event);
//});


//MIDI.on([144]).log();
//MIDI.on({ channel: 1, message: /^note|^pitch/ }).normalise().log();
//MIDI.on({ message: /^note|^pitch/ }).log();

var s0 = MIDI.on({ message: /^note|^pitch/ }).log().map(Fn.identity).slice(2,6);

var s1 = s0.head().map(function(a) { a.push('HEAD'); return a; }).log();

MIDI.trigger([144,127,0]);
MIDI.trigger([144,127,1]);
MIDI.trigger([144,127,2]);
MIDI.trigger([144,127,3]);

var s2 = s0.tail().map(function(a) { a.push('TAIL'); return a; }).log();

MIDI.trigger([144,127,4]);
MIDI.trigger([144,127,5]);
MIDI.trigger([144,127,6]);
MIDI.trigger([150,127,7]);
MIDI.trigger([150,127,8]);

var s3 = s0.tail().map(function(a) { a.push('AFTER'); return a; }).log();

MIDI.trigger([150,127,9]);
MIDI.trigger([150,127,10]);
MIDI.trigger([150,127,11]);
console.log('------------');
	</script>
</body>
</html>
